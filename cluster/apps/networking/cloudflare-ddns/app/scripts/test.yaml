apiVersion: batch/v1
kind: Job
metadata:
  name: cf-ddns-test
  namespace: networking
spec:
  template:
    spec:
      automountServiceAccountToken: true
      containers:
      - name: app
        image: ghcr.io/onedr0p/kubanetics:2024.8.1@sha256:45ffec868c477b1ae0e339dffb0bcec4dddb4de5ff3ac2562002401fccb201a8
        command: ["/bin/bash", "-c", "sleep 10000000"]
          #command:
          #- /app/cloudflare-ddns.sh
        env:
        - name: CLOUDFLARE_DOMAIN
          value: thekao.cloud
        - name: CLOUDFLARE_EMAIL
          value: cloudflare@thetall.gent
        - name: CLOUDFLARE_TOKEN
          value: 7b77d37dc3ae75f1870a4076ee2458c20ce2d
        - name: PUSHOVER_TOKEN
          value: u3aefqjeiec7jijtkhta9febn2k5i5
        - name: PUSHOVER_USER_KEY
          value: ar7bk6z3fjyqjvaf5d36e6exmbdt78
        resources:
          limits:
            memory: 16Mi
          requests:
            cpu: 5m
            memory: 16Mi
        volumeMounts:
        - name: config
          mountPath: /app/cloudflare-ddns.sh
          subPath: cloudflare-ddns.sh
          readOnly: true
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      restartPolicy: Never
      securityContext: {}
      serviceAccount: default
      serviceAccountName: default
      terminationGracePeriodSeconds: 30
      volumes:
      - name: config
        configMap:
          name: cloudflare-ddns-configmap
          defaultMode: 509
      dnsPolicy: ClusterFirst
      enableServiceLinks: false
      nodeName: k3s-worker-00
      preemptionPolicy: PreemptLowerPriority
      priority: 0
      schedulerName: default-scheduler
